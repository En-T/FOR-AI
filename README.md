# School Analytics

Система аналитики школьных данных для управления школами, учащимися, учителями, классами, предметами и оценками.

## Технологический стек

- **Django 4.2 LTS** - Backend framework
- **Python 3.10+** - Язык программирования
- **SQLite** - База данных (для разработки)
- **Bootstrap 5** - Frontend framework
- **django-crispy-forms** - Улучшенные формы Django

## Основные возможности

### Модели данных

1. **UserProfile** - Профили пользователей с ролями:
   - Superuser (Суперпользователь)
   - Education Dept (Отдел образования)
   - School Admin (Администратор школы)

2. **School** - Школы с информацией о директоре, адресе и выпускном классе (4, 9 или 11)

3. **Subject** - Предметы (глобальный список для всех школ)

4. **Class** - Классы в школах

5. **Student** - Учащиеся с привязкой к классу

6. **Teacher** - Учителя с привязкой к школе

7. **ClassSubjectGroup** - Подгруппы для предметов в классах с уровнями (базовый/повышенный)

8. **StudentSubjectGroup** - Распределение учащихся по подгруппам

9. **Grade** - Оценки учащихся по предметам и четвертям (1-10 баллов)

10. **AuditLog** - Журнал всех действий в системе

### Система аутентификации

- Вход/выход из системы
- Управление ролями через middleware
- Миксины для ограничения доступа по ролям:
  - `SuperuserOnlyMixin`
  - `EducationDeptOnlyMixin`
  - `SchoolAdminOnlyMixin`

### Система логирования

- Логирование всех действий пользователей (создание, редактирование, удаление)
- Логирование входов/выходов
- Автоматическое отслеживание изменений через Django signals
- Файлы логов:
  - `logs/app.log` - общие логи приложения
  - `logs/errors.log` - только ошибки

## Установка и запуск

### Требования

- Python 3.10 или выше
- pip (менеджер пакетов Python)

### Шаги установки

1. **Клонировать репозиторий:**
   ```bash
   git clone <repository-url>
   cd school_analytics
   ```

2. **Создать виртуальное окружение:**
   ```bash
   python3 -m venv venv
   source venv/bin/activate  # Для Linux/Mac
   # или
   venv\Scripts\activate  # Для Windows
   ```

3. **Установить зависимости:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Применить миграции:**
   ```bash
   python manage.py migrate
   ```

5. **Создать суперпользователя:**
   ```bash
   python manage.py createsuperuser
   ```
   Следуйте инструкциям и введите имя пользователя, email и пароль.

6. **Запустить сервер разработки:**
   ```bash
   python manage.py runserver
   ```

7. **Открыть в браузере:**
   - Главная страница: http://127.0.0.1:8000/
   - Админ-панель: http://127.0.0.1:8000/admin/
   - Вход: http://127.0.0.1:8000/login/

## Структура проекта

```
school_analytics/
├── core/                      # Основное приложение
│   ├── migrations/            # Миграции базы данных
│   ├── templates/             # Шаблоны
│   │   └── core/
│   │       ├── login.html     # Страница входа
│   │       └── dashboard.html # Главная страница
│   ├── admin.py               # Настройка админ-панели
│   ├── apps.py                # Конфигурация приложения
│   ├── current_user.py        # Управление текущим пользователем
│   ├── middleware.py          # Middleware для ролей и логирования
│   ├── mixins.py              # Миксины для views
│   ├── models.py              # Модели данных
│   ├── signals.py             # Сигналы для аудита
│   ├── urls.py                # URL маршруты
│   └── views.py               # Представления
├── school_analytics/          # Настройки проекта
│   ├── settings.py            # Основные настройки
│   ├── urls.py                # Главные URL маршруты
│   └── wsgi.py                # WSGI конфигурация
├── logs/                      # Логи (создается автоматически)
├── media/                     # Загруженные файлы
├── static/                    # Статические файлы
├── templates/                 # Общие шаблоны
├── manage.py                  # Django CLI
├── requirements.txt           # Зависимости Python
└── README.md                  # Этот файл
```

## Использование

### Админ-панель

После создания суперпользователя войдите в админ-панель по адресу http://127.0.0.1:8000/admin/

В админ-панели доступны:
- Управление пользователями и их профилями
- CRUD операции для всех моделей
- Просмотр журнала аудита

### Логирование

Все действия пользователей автоматически логируются:
- Создание, изменение и удаление объектов
- Вход и выход из системы
- Изменения записываются в модель `AuditLog` и в файлы логов

### Роли пользователей

1. **Superuser** - полный доступ ко всей системе
2. **Education Dept** - доступ к управлению школами
3. **School Admin** - доступ к управлению своей школой

## Разработка

### Создание новых миграций

После изменения моделей:
```bash
python manage.py makemigrations
python manage.py migrate
```

### Запуск Django shell

```bash
python manage.py shell
```

### Создание данных для тестирования

```python
from django.contrib.auth.models import User
from core.models import *

# Создать школу
school = School.objects.create(
    name="Школа №1",
    director="Иванов Иван Иванович",
    graduation_class=11,
    location="г. Москва, ул. Ленина, д. 1"
)

# Создать предмет
subject = Subject.objects.create(name="Математика")

# И т.д.
```

## Логи

Логи сохраняются в директории `logs/`:
- `app.log` - все события приложения (INFO и выше)
- `errors.log` - только ошибки (ERROR и выше)

Ротация логов настроена на:
- Максимальный размер файла: 10 MB
- Количество бэкапов: 5

## Безопасность

- Пароли хранятся в хешированном виде
- CSRF защита включена
- Все действия логируются
- Middleware проверяет роли пользователей

## Настройки локализации

- Язык: Русский (ru-ru)
- Часовой пояс: Europe/Moscow
- Используется часовой пояс базы данных

## Зависимости

Подробный список зависимостей находится в `requirements.txt`:
- Django 4.2.17
- django-crispy-forms 2.3
- crispy-bootstrap5 2024.10
- Pillow 10.4.0

## Лицензия

[Укажите вашу лицензию здесь]

## Контакты

[Укажите контактную информацию]
