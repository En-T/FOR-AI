{% extends "base.html" %}

{% block title %}Students - School Management System{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Students</h1>
    <div>
        <a href="/students/create/" class="btn btn-primary">Add Student</a>
        <a href="/students/bulk-upload/" class="btn btn-secondary">Bulk Upload</a>
    </div>
</div>

<div class="filters">
    <div class="form-group">
        <label for="class-filter">Filter by Class:</label>
        <select id="class-filter" class="form-control">
            <option value="">All Classes</option>
            {% for class in classes %}
            <option value="{{ class.id }}" {% if selected_class_id == class.id|stringformat:"s" %}selected{% endif %}>
                {{ class.name }}
            </option>
            {% endfor %}
        </select>
    </div>
</div>

<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>Full Name</th>
                <th>Class</th>
                <th>Subgroups</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
            <tr>
                <td>{{ student.full_name }}</td>
                <td>{{ student.school_class.name }}</td>
                <td>
                    {% for assignment in student.subgroup_assignments.all %}
                    <span style="margin-right: 5px; padding: 2px 6px; background-color: #ecf0f1; border-radius: 3px;">
                        {{ assignment.subgroup.name }} ({{ assignment.subgroup.subject.name }})
                    </span>
                    {% empty %}
                    -
                    {% endfor %}
                </td>
                <td class="actions">
                    <a href="/students/{{ student.id }}/update/" class="btn btn-secondary btn-sm">Edit</a>
                    <form action="/students/{{ student.id }}/delete/" method="post" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm" data-delete-confirm="Are you sure you want to delete this student?">Delete</button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4">No students found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
document.getElementById('class-filter').addEventListener('change', function() {
    const classId = this.value;
    window.location.href = classId ? '/students/?class_id=' + classId : '/students/';
});
</script>
{% endblock %}
